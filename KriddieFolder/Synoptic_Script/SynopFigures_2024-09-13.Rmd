---
title: "SynopFigures_2022-04-20"
author: "Kriddie"
date: '2024-02-10'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(here)
library(readr)
library(tidyr) # for `gather`
library(ggplot2)
library(cowplot)
library(tidyverse)
library(rstatix)
library(ggpubr)
library(plotly)
library(gridExtra)
library(grid)
library(ggmap)
library(dplyr)
library(scales)
library(olsrr)

#register_stadiamaps(key = "4c9564bd-71e6-4396-8cef-e76e893129ce", write = TRUE)

#new api
register_stadiamaps("e723ef39-9560-41be-969c-36870f7b7f84", write = TRUE)

library(scales)


```

## Description
This file is to generate figures for my synoptic paper

*Objective:*
The objective of this study is to identify high resolution spatial patterns in pCO2, CO2 flux and geomorphology within a Paramo river network.

Hypothesis 1: Off-gassing from upstream reaches and decreased connection with groundwater will result in decreasing pCO2 within a river reach from upstream to downstream and within a river network from smaller to larger streams. 

Hypothesis: 2: Higher turbulence in larger streams will yield flux rates than smaller streams




#read in data


```{r read in data}
df<- read_csv(here::here("ProcessedData/ALLSYNOPDATA_FINAL_2024-05-07.csv"))%>%rename(adjusted_ppm=pCO2_ppm)


synop_allsites <- read.csv(here::here("ProcessedData/synop_allsites_slope.csv"))
synop_allsites_nowetland <- read.csv(here::here("ProcessedData/synop_allsites_nowetland_slope.csv"))
XWD_allsites <- read.csv(here::here("ProcessedData/xwd_allsites_slope.csv"))
Q_df <- read.csv(here::here("ProcessedData/Q_synop.csv"))
```


```{r hydro geometry plots}
#first plot w v catchment
options(scipen = 999)
p_Q <- ggplot(Q_df,aes(x=catchment_ha,y=Q_m3s*1000)) + geom_point(size=3) + scale_y_log10() + scale_x_log10()+ 
  geom_smooth(method='lm', formula= y~x) +
  ylab("Q (L/s)") + xlab("Catchment size (ha)") +
  annotate("text", x=10, y=50, label= "r2 = 0.70  \npvalue = <.001",size=6,color="red") + 
  theme_bw(base_size = 24)

p_width <- ggplot(XWD_allsites,aes(x=catchment_ha,y=w)) + geom_point(size=3) + scale_y_log10() + scale_x_log10()+ 
  geom_smooth(method='lm', formula= y~x) + 
  ylab("Width (cm)") + xlab("Catchment size (ha)") +
  annotate("text", x=10, y=700, label= "r2 = 0.3395  \npvalue = <.001",size=6,color="red") + 
  theme_bw(base_size = 24)

p_depth <- ggplot(XWD_allsites%>%drop_na(slope_mid),aes(x=catchment_ha,y=d,fill=log1p(slope_mid))) + geom_point(size=3,shape=21) + scale_y_log10() + scale_x_log10()+ 
  geom_smooth(method='lm', formula= y~x)+ 
  ylab("Depth (cm)") + xlab("Catchment size (ha)") + 
  annotate("text", x=10, y=100, label= "r2 = 0.5016 \npvalue = <.001",size=6,color="red") + 
  scale_fill_gradient(low = "yellow", high = "darkgreen", na.value = NA) +
  theme_bw(base_size = 24)+
  labs(fill="Slope \n (log1p)")


p_co2 <- ggplot(synop_allsites%>%drop_na(slope_up),aes(x=catchment_ha,y=adjusted_ppm,fill=slope_up)) + 
  geom_point(size=3,shape=21) + scale_y_log10() + scale_x_log10()+ 
  geom_smooth(method='lm', formula= y~x)+
  scale_fill_gradient(low = "yellow", high = "darkgreen", na.value = NA) +
  annotate("text", x=10, y=10000, label= "r2 = 0.2686  \npvalue = <.001",size=6,color="red") + 
  ylab(expression(italic(p)~CO[2] ~'(ppm)')) + xlab("") + xlab("Catchment size (ha)") + 
  theme_bw(base_size = 24)+
  labs(fill="Slope \n (log1p)")

p_co2_nowetland <- ggplot(synop_allsites_nowetland%>%drop_na(slope_up),aes(x=catchment_ha,y=adjusted_ppm,fill=slope_up)) + 
  geom_point(size=3,shape=21) + scale_y_log10() + scale_x_log10()+ 
  geom_smooth(method='lm', formula= y~x)+
  scale_fill_gradient(low = "yellow", high = "darkgreen", na.value = NA) +
  annotate("text", x=10, y=10000, label= "r2 = 0.4178  \npvalue = <.001",size=6,color="red") + 
  ylab(expression(italic(p)~CO[2] ~'(ppm)')) + xlab("") + xlab("Catchment size (ha)") +
  theme_bw(base_size = 24)



```

#fig 1
this is a site map generated using arcpro, not included here

#fig 2
Show general downward trend in co2
river network and reach

#Stats

```{r Stats for fig 2a, echo=FALSE}

#gavi rivernetwork vs catchment size
model1 <- lm(log(adjusted_ppm)~ log(CatchmentSize_ha), 
             data = df %>%filter(Wetland_3=="Gavilan River Network"))
summary(model1)




#antenas  cos v dist
model1 <- lm(log(adjusted_ppm)~ dist, 
             data = df %>%filter(Wetland_2=="Antenas"))
summary(model1)

ols_plot_resid_qq(model1)
ols_test_normality(model1)

#gavi outlet cos v dist
model1 <- lm(log10(adjusted_ppm)~ dist, 
             data = df %>%filter(Wetland_4=="Gavilan Outlet"))
summary(model1)

ols_plot_resid_qq(model1)
ols_test_normality(model1)

#gavi trib 1  cos v dist
model2 <- lm(log10(adjusted_ppm)~ dist, 
             data = df %>%filter(Wetland=="GAVItrib1"))
summary(model2)
#gavi trib 2  cos v dist
model3 <- lm(log10(adjusted_ppm)~ dist, 
             data = df %>%filter(Wetland=="GAVItrib2"))
summary(model3)

#gavi trib 3  cos v dist
model4 <- lm(log10(adjusted_ppm)~ dist, 
             data = df %>%filter(Wetland=="GAVItrib3"))
summary(model4)

#colm  co2 v dist
model1 <- lm(log(adjusted_ppm)~ dist, 
             data = df %>%filter(Wetland_4=="COLM"))
summary(model1)

#gavi inlet cos v dist
model1 <- lm(log10(adjusted_ppm)~ dist, 
             data = df %>%filter(Wetland_4=="Gavilan Inlet"))
summary(model1)


```

#stats to report:
*Gavi river network v log c02*
pvalue = 2.875e-06, r2 = 0.3139 

*co2 v distance*
Gavi inlet p-value= 0.8892, r2 = -0.0889  
Gavi outlet p-value= 6.573e-06, r2 = 0.6102 * 
Gavi trib1 p-value= 0.02733, r2 = 0.313 *
Gavi trib2 p-value= 0.1107, r2 = 0.6862 
Gavi trib3 p-value= 0.097253, r2 = 0.5394 .
ANTE p-value = 0.0109, r2 = 0.2847 *

pannel 2c got really complicated. Below is code for all the different componenets, and then I brought it into a power point to finish it up

```{r fig 2a, echo=FALSE}


MyTheme <-  theme_bw() + 
  theme(axis.text=element_text(size=14),
        axis.title=element_text(size=16)) +
  theme(legend.text=element_text(size=16))+
  theme(aspect.ratio=1)

rivernetwork <- ggplot(df %>%filter(Wetland_3=="Gavilan River Network"), aes(x = CatchmentSize_ha, y = log10(adjusted_ppm))) + 
  geom_point(size=3) +
  theme_bw() + 
  ylab(expression(paste(italic('p'),"CO"[2] ," [ppm]")))+
  xlab("Catchment Size [Hectares]") +
  scale_y_continuous(breaks=c(log10(300),log10(1000), log10(3000), log10(10000)), labels=c("300","1,000","3,000","10,000")) +
  geom_smooth(method='lm') +
  MyTheme + 
  annotate("text", x = 95, y = log10(10000), label  = expression("p-value < .0001\n", r^2 ~ "=" ~ .314), size = 4)

df <- df[order(df$adjusted_ppm),]
#?get_stadiamap()

gaviplot <- qmplot(lon_fit, lat_fit, data = df %>%filter(Wetland_3=="Gavilan River Network")%>%drop_na(adjusted_ppm),size= 6, maptype = "stamen_terrain", color = log10(adjusted_ppm)) +
  scale_color_gradient(low="blue", high="red",
                       breaks=c(log10(300),log10(1000), log10(3000), log10(10000)), labels=c("300","1,000","3,000","10,000"))+
    guides(size = "none") +
  theme(legend.text=element_text(size=14)) + 
  labs(color=expression(paste(italic('p'),"CO"[2] ," [ppm]"))) +
  theme(legend.title=element_text(size=16), 
    legend.text=element_text(size=14)) 


### c.

#annotate text 
dat_text <- data.frame(
  label = c("p-value = 0.011", "p-value < .0001", 
            "p-value = 0.027","p-value = 0.11"),
  Wetland_4   = c("ANTE", "Gavilan Outlet", "GAVItrib1", "GAVItrib2"),
  Wetland = c("ANTE","Gavi-mainstem","GAVItrib1","GAVItrib2"))


#subtract 523m from outlet
df[df$Wetland_4 == 'Gavilan Outlet',]$dist <- df[df$Wetland_4 == 'Gavilan Outlet',]$dist - 523

Wetland_4_names <- c(
                    "ANTE" = "Antenas",
                    "Gavilan Outlet" = "Gavil\u00e1n Outlet",
                    "GAVItrib1" = "Gavil\u00e1n Tributary 1",
                    "GAVItrib2" = "Gavil\u00e1n Tributary 2"
                    )

p2 <- ggplot(df %>%drop_na(Wetland)%>%filter(Wetland_4!="Gavilan Inlet")%>%filter(Wetland!="COLM")%>%filter(Wetland!="GAVItrib3")
             , aes(x = dist, y = adjusted_ppm)) +
  geom_point(size=3) +  
  facet_grid(Wetland_4~.,labeller = as_labeller(Wetland_4_names)) + geom_smooth(method='lm')+
  ylab(expression(paste(italic('p'),"CO"[2] ," [ppm]"))) + xlab("Distance downstream [m]") +
  theme_bw() +
  scale_y_continuous(trans = "log10", breaks=c(300,1000,3000,10000), labels=c("300","1,000","3,000","10,000")) +  theme(text = element_text(size = 14))

p3 <- p2 + geom_text(
  data    = dat_text,
  mapping = aes(x = 400, y = 9000, label = label))
p3

df1 <- df%>%drop_na(Wetland)%>%filter(Wetland_4=="ANTE"|Wetland_4=="Gavilan Outlet"|Wetland_4=="Gavilan Inlet"|Wetland_4=="COLM")
df1$Wetland_4<- factor(df1$Wetland_4, levels = c("ANTE", "Gavilan Outlet", "Gavilan Inlet", "COLM"))
df1$adjusted_ppm[df1$Wetland_4 == "ANTE"] <- NA
df1$adjusted_ppm[df1$Wetland_4 == "Gavilan Outlet"] <- NA


Wetland_4_names2 <- c(
                    "ANTE" = "Antenas",
                    "Gavilan Outlet" = "Gavil\u00e1n Outlet",
                    "Gavilan Inlet" = "Gavil\u00e1n Intlet",
                    "COLM" = "Colmillo"
                    
                    )


p4 <- ggplot(df1%>%drop_na(Wetland), aes(x = dist, y = adjusted_ppm)) +
  geom_point(size=3) + 
  facet_grid(Wetland_4~.,labeller = as_labeller(Wetland_4_names2)
             ) +
  ylab(expression(paste(italic('p'),"CO"[2] ," [ppm]"))) + xlab("Distance downstream [m]") +
  theme_bw() +
  scale_y_continuous(trans = "log10", breaks=c(300,1000,3000), labels=c("300","1,000","3,000")) +
  expand_limits(y = c(200, 4000)) + 
  theme(text = element_text(size = 14))
p4

p5 <- p4 + geom_text(
  data    = dat_text2,
  mapping = aes(x = 900, y = 3000, label = label),
)
p5


figure1 <- ggarrange(rivernetwork, gaviplot,
                    labels = c("A","B"),
                    ncol = 1, nrow = 2,
               #    align = "hv",
                    widths = c(1, .8),
              #    heights = c(.6,.4),
                  font.label = list(size = 25, color = "black", face = "bold", family = NULL, position = "top"))

figure2 <- ggarrange(figure1, p3,
                    labels = c("","C"),
                    ncol = 2, nrow = 1,
              #     align = "hv",
               #     widths = c(1, .8),
              #    heights = c(.6,.4),
                  font.label = list(size = 25, color = "black", face = "bold", family = NULL, position = "top"))


```

#slope fig

```{r fig 4 boxplots, echo=FALSE}
df <- read.csv(here::here("ProcessedData/raymond_data_allsites_2024-09-16.csv"))


model1.2 <- lm(log(adjusted_ppm) ~ scale(log1p(slope_up)) #+
#                 scale(log(catchment_ha))
, data = df %>%filter(catchment_ha > 12.5)
               )
summary(model1.2)

ols_plot_resid_qq(model1.2)
ols_test_normality(model1.2)


theme_set(theme_bw(base_size = 16))

p <- ggplot(df  %>%filter(catchment_ha > 12.5), 
       aes(x=slope_up,y=adjusted_ppm, color=catchment_ha)) +
  scale_y_continuous(trans = "log10", breaks=c(300,1000,3000,10000), labels=c("300","1,000","3,000","10,000")) +
  geom_point(size=2) +
  geom_smooth(method = "lm",color="black") +
  ylab(expression(paste(italic('p'),"CO"[2] ," [ppm]"))) + xlab("Slope [m/m]") +
  scale_colour_gradient(
  name = "Catchment Size [ha]",
  low = "yellow3",
  high = "green4",
  space = "Lab",
  na.value = "grey50",
  guide = "colourbar",
  aesthetics = "colour"
)


```

# trends in flux 

#fig 4

Box plots
```{r fig 4 boxplots, echo=FALSE}

df <-read.csv(here::here("ProcessedData/raymond_data_allsites_2024-09-16.csv"),na.strings=c("","NA"))
df$name_2 <- df$name
df$name_2[which(df$name_2 == "GaviTrib1")] = "GaviTribs"
df$name_2[which(df$name_2 == "GaviTrib2")] = "GaviTribs"


###box and wisker####
anova.co2 <- aov(log(adjusted_ppm) ~ name, data = df)
summary(anova.co2)

anova.flux <- aov(log1p(F_mol_m2_d_eq1) ~ name, data = df)
summary(anova.flux)

anova.k600 <- aov(log1p(k600_eq1_final) ~ name, data = df)
summary(anova.k600)

tukey.co2<-TukeyHSD(anova.co2)
tukey.co2

tukey.flux<-TukeyHSD(anova.flux)
tukey.flux

tukey.k600<-TukeyHSD(anova.k600)
tukey.k600

MyTheme <-  theme_bw() + 
  theme(
    axis.text.x = element_blank(),
    axis.ticks.x = element_blank(),
    axis.title.x = element_blank()) +
  theme(axis.text=element_text(size=14),
        axis.title=element_text(size=14)) +
  theme(legend.text=element_text(size=16))

air_ppm <- 416.45
CO2 <- ggplot(df, aes(x = name_2, y = adjusted_ppm, fill = name_2)) +
  geom_boxplot() +
  geom_jitter(shape=18,position=position_jitter(0.1)) +
   stat_summary(fun = "mean", geom = "point", shape = 23, size = 3, color = "black",fill="white")+
  geom_hline(yintercept= log10(air_ppm),color="red",linetype="twodash", linewidth=1) +
  scale_y_log10() +
  MyTheme


flux <- ggplot(df, aes(x = name_2, y = F_mol_m2_d_eq1, fill = name_2)) + 
  geom_boxplot() +
  geom_jitter(shape=18,position=position_jitter(0.1)) +
   stat_summary(fun = "mean", geom = "point", shape = 23, size = 3, color = "black",fill="white")+
  scale_y_log10() +
  MyTheme


k600 <- ggplot(df%>%drop_na(x), aes(x = name_2, y = k600_eq1_final, fill = name_2)) + 
  geom_boxplot() +
  geom_jitter(shape=18,position=position_jitter(0.1)) +
   stat_summary(fun = "mean", geom = "point", shape = 23, size = 3, color = "black",fill="white") +
  scale_y_log10()+
  MyTheme
  
slope <- ggplot(df%>%drop_na(x), aes(x = name_2, y = slope)) + 
  geom_boxplot() +
  geom_jitter(shape=18,position=position_jitter(0.1)) +
   stat_summary(fun = "mean", geom = "point", shape = 23, size = 3, color = "black",fill="white") +
  scale_y_log10()

v_ms <- ggplot(df %>%drop_na(x), aes(x = name_2, y = v_ms)) + 
  geom_boxplot() +
  geom_jitter(shape=18,position=position_jitter(0.1)) +
   stat_summary(fun = "mean", geom = "point", shape = 23, size = 3, color = "black",fill="white") +
  scale_y_log10()



require(grid)  



figure <- ggarrange(CO2 , flux,  k600,
                  #  labels = c("A","B","C"),
                    ncol = 1, nrow = 3,
                    common.legend = TRUE, legend = "right",
                    align = "hv", 
                  #  hjust   = -0.5,
                    font.label = list(size = 20, color = "black", face = "bold", family = NULL, position = "top"))

figure



```


#fig 6

for < 12.5 hectars, watershed size is not significant, co2 is significant
r2 = 0.5247, pvalue =2.43e-07
for > 20 ha, co2 is not significant, but watershed size is. pvalue = 0.00395 r2 = 0.1057

```{r fig 6, echo=FALSE}

df_sats <- df
df_sats$co2_scale <-scale(df_sats$adjusted_ppm)
df_sats$WS_scale <- scale(df_sats$catchment_ha)

model1_1 <- lm(log1p(F_mol_m2_d_eq1) ~ log1p(adjusted_ppm), 
             data = df_sats %>%#filter(F_CO2_umol_m2_s>-1)%>%
               filter(catchment_ha<12.5))
summary(model1_1)

ols_plot_resid_qq(model1_1)
ols_test_normality(model1_1)

#
model2_2 <- lm(log1p(F_mol_m2_d_eq1) ~  log(catchment_ha), 
             data = df_sats %>%filter(catchment_ha>20)#%>%filter(F_CO2_umol_m2_s>-1)
             )
summary(model2_2)
ols_plot_resid_qq(model2_2)
ols_test_normality(model2_2)
#
model1_3 <- lm(log1p(F_mol_m2_d_eq1) ~  log(catchment_ha) + log(adjusted_ppm), 
             data = df_sats)
summary(model1_3)

model1_3 <- lm(log1p(F_mol_m2_d_eq1) ~  scale(log(catchment_ha)) + scale(log(adjusted_ppm)), 
             data = df_sats)
summary(model1_3)

ols_plot_resid_qq(model1_3)
ols_test_normality(model1_3)

#

#####################
MyTheme <-  theme_bw() + 
  theme(axis.text=element_text(size=14),
        axis.title=element_text(size=16)) +
  theme(legend.title = element_text(size=18),
    legend.text=element_text(size=16))

hex <- hue_pal()


A <- ggplot(df %>%filter(catchment_ha<12.5),
        aes(x=log10(adjusted_ppm), y=F_mol_m2_d_eq1)) +
  geom_point(aes(fill=name), 
       color="black",pch=21, size=3) + 
  scale_y_log10() +
  geom_vline(xintercept= log10(air_ppm),color="red",linetype="twodash", linewidth=1) +
  geom_smooth(method='lm') +
  xlab("CO2 ppm") + 
  ylab(expression(paste("CO"[2]," Flux [",mu,"mol ", m^-2, s^-1,"]"))) +
  labs(linetype="LEGEND", color="LEGEND") +
  scale_fill_manual(name="Stream Reach",labels=c("Antenas", "Gavil\u00e1n Tributary 1","Gavil\u00e1n Tributary 3"), values = c(antens, gavitrib1, gavitrib3)) + scale_x_log10()  + MyTheme 



B <- ggplot(df_sats %>%filter(F_mol_m2_d_eq1>-.6)
            %>%filter(catchment_ha>20),
        aes(x=catchment_ha, y=F_mol_m2_d_eq1)) +
  geom_point(aes(fill=name), 
       color="black",pch=21, size=3) + 
  scale_y_log10() +
    scale_x_log10() +
  geom_smooth(method='lm') +
  xlab("Catchment Size [ha]") + 
  ylab(expression(paste("CO"[2]," Flux [",mu,"mol ", m^-2, s^-1,"]"))) + 
  labs(linetype="LEGEND", color="LEGEND") +
  scale_fill_manual(
    name="Stream Reach",
    labels=c( "Colmillo","Gavil\u00e1n","Gavil\u00e1n Tributary 2"),values = c(colmillo, gavi,gavitrib2))+
   theme_bw()  + MyTheme



figure <- ggarrange(A , B,  
                #    labels = c("A","B"),
                    ncol = 1, nrow = 2,
                    #common.legend = TRUE, 
                    legend = "right",
                    align = "hv", 
                    font.label = list(size = 25, color = "black", face = "bold", family = NULL, position = "top"))

figure

ggsave("fig5.png", plot = figure, device = NULL, path = NULL,
       scale = 1, width = 20, height = 20, dpi = 360, limitsize = TRUE,
       units = c("cm"))


```


```{r fig 5 k600, echo=TRUE}
df <- read.csv(here::here("ProcessedData/raymond_data_allsites_2024-09-16.csv"))
p <- ggplot(df, 
            aes(x=catchment_ha,y=k600_eq1_final)) +
  scale_y_log10() + scale_x_log10() +
  geom_point(size=2) +
  geom_smooth(method = "lm",color="black") +
  ylab(expression(paste(italic('k'),"600 [m d" ^1,"]"))) + xlab("Catchment Size [ha]")
p

### bins
df_bins <- df
df_bins$CatchmentSize_ha_log <- log(df_bins$CatchmentSize_ha)
df_bins <- df_bins%>%select(CatchmentSize_ha_log,K600) %>%
  filter(K600 > -30) %>%
  mutate(Catchment_bin = cut(CatchmentSize_ha_log, breaks=5)) #%>% 

df_bins_summary <-df_bins%>%
  group_by(Catchment_bin) %>%
  summarise(
    k600_mean = mean(K600, na.rm = TRUE),
    k600_stdev = sd(K600, na.rm = TRUE),
    k600_median = median(K600, na.rm = TRUE),
    k600_max = max(K600, na.rm = TRUE),
    k600_min = min(K600, na.rm = TRUE),
    n())

df_bins$Catchment_bin2 <- as.character(df_bins$Catchment_bin)
df_bins$Catchment_bin3 <- gsub("]", "", df_bins$Catchment_bin2) 
df_bins$Catchment_bin4 <- sub('.', '', df_bins$Catchment_bin3)
df_bins[c('min_log', 'max_log')] <- str_split_fixed(df_bins$Catchment_bin4, ',', 2)
df_bins$min_log <- as.numeric(df_bins$min_log )
df_bins$max_log <- as.numeric(df_bins$max_log )

df_bins$min <- signif(exp(df_bins$min_log),digits =2)
df_bins$max <- signif(exp(df_bins$max_log),digits =2)

df_bins$bins_true  <- paste(df_bins$min, "-", df_bins$max)

df_bins$bins_true = factor(df_bins$bins_true, levels=c("0.11 - 0.5","0.5 - 2.3","2.3 - 10","10 - 47","47 - 210"))

k600_boxplot <- ggplot(df_bins, aes(x=bins_true, y=K600)) + 
  geom_boxplot(fill="grey", notch=FALSE)+
  geom_jitter(width = 0.2)+ 
    stat_summary(fun.y=mean, geom="point", shape=23,size=3,color="black",fill="red") +
  scale_y_log10() +
    ylab(expression(paste("mean ",italic('k')[600]," [m ", d^-1,"]"))) + 
  xlab("Catchment size [ha]") +
  theme_bw(base_size = 16) 


###bar plots

df_bins$bins_true <- factor(df_bins$bins_true, levels = df_bins$bins_true[order(df_bins$min)])

p1<-ggplot(data=df_bins, aes(x=bins_true, y=k600_stdev)) +
  geom_bar(stat="identity", color="black",fill="grey", width=1)+ 
    ylab(expression(paste("standard deviation"))) + xlab("Catchment size (Hectar)") +
  theme_bw(base_size = 16)
    
p1


p2<-ggplot(data=df_bins, aes(x=Catchment_bin, y=k600_mean)) +
  geom_bar(stat="identity", color="black",fill="grey", width=1) +
  geom_point(aes(x=Catchment_bin,y=k600_median),shape=23,size=4,color="black",fill="black") + 
    ylab(expression(paste("mean ",italic('k')[600]," [m ", d^-1,"]"))) +
  theme_bw(base_size = 16) +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank()) 
p2

full <- ggarrange(p2, p1, nrow = 2, common.legend = TRUE)

```


#plot


```{r bball fig, echo=FALSE}
df <- read.csv(here::here("ProcessedData/raymond_data_allsites_2024-09-16.csv"))

bball <- ggplot(df, 
                     aes(x=x, y=flux_sum, group=name)) +
  geom_line(aes(color=name), linewidth=3) +
  geom_point(aes(fill=name), size=1,shape=1)+
    ylab(expression(paste("Cumulative CO"[2]," Flux [",mu,"mol ", s^-1,"]"))) +
  xlab("Distance [m]")
  theme_bw() 

bball

#zoom in
bball_zoom <- ggplot(df, 
                     aes(x=x, y=flux_sum, group=name)) +
  geom_line(aes(color=name), linewidth=3) +
  geom_point(aes(fill=name), size=1,shape=1)+
    ylab(expression(paste("Cumulative CO"[2]," Flux [",mu,"mol ", s^-1,"]"))) +
  xlab("Distance [m]")  +
    guides(fill=FALSE) +
  xlim(-10, 500) +
  ylim(-20, 800) +
  theme_bw() 


bball_zoom

#write.csv(df_test,here::here("ProcessedData/bball_dataframe.csv"))

```
